#!/bin/bash

ACTION="Open Push"
TITLE="Push notification from `hostname`"
SUBTITLE="`date`"
ICONURL="https://dl.dropboxusercontent.com/u/172539/icons/vps.png"
SOUND=""
CURL="/usr/bin/curl"

if [ -e ~/.config/goznotify.conf ]; then
    source ~/.config/goznotify.conf
else
    echo "Config file ~/.config/goznotify.conf not found."
    exit
fi    

sendTopic() {
# Telegram Zuul
	echo "Posting to ${BOTGROUP} - ${TOPIC}"
	${CURL}  -X POST \
    https://api.telegram.org/bot${APIKEY}/sendMessage \
    --data-urlencode text="${prefix}${MESSAGE}" \
	-d disable_web_page_preview=true \
    -d parse_mode="Markdown" \
	-d message_thread_id="${TOPIC}" \
    -d chat_id=${BOTGROUP}

}

level="$1"

# If first arg is a known level, shift it off. Otherwise treat everything as the message.
case "$level" in
alert|warn|info)
  shift
  ;;
*)
  level="info"
  ;;
esac

MESSAGE="$*"

case "$level" in
alert)
  thread="4"
  prefix="üö® "
  ;;
warn)
  thread="12"
  prefix="‚ö†Ô∏è "
  ;;
info)
  thread=""
  prefix=""
  ;;
esac

# Optional: export TOPIC for other parts of your script to inspect
TOPIC="$thread"

sendTopic
